<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ALox: Singleton&lt; TDerivedClass &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="aworx_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="A-Worx-Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ALox
   &#160;<span id="projectnumber">V. 1709 R. 0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--ALox Main Menu-->
<div style="background: #2f3a48; " >
<table  class="aworx-menutable"  >
 <tbody>
 <tr style="height: 36px;">
  <td> <a class="aworx-menu"    href="../index.html"                  >Home</a>                     </td>
  <td> <a class="aworx-menu_hl" href="../cpp_ref/cppmainpage.html"    >ALox for C++</a>             </td>
  <td> <a class="aworx-menu"    href="../cs_ref/csmainpage.html"      >ALox for C#</a>              </td>
  <td> <a class="aworx-menu"    href="../java_ref/javamainpage.html"  >ALox for Java</a>            </td>
  <td> <a class="aworx-menu"    href="https://github.com/AlexWorx/ALox-Logging-Library">Download</a></td>
 </tr>
 </tbody>
</table>
</div>
<!--end ALox Main Menu-->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceaworx.html">aworx</a></li><li class="navelem"><a class="el" href="namespaceaworx_1_1lib.html">lib</a></li><li class="navelem"><a class="el" href="namespaceaworx_1_1lib_1_1lang.html">lang</a></li><li class="navelem"><a class="el" href="classaworx_1_1lib_1_1lang_1_1Singleton.html">Singleton</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Public Static Methods</a> &#124;
<a href="#pub-methods">Public Methods</a> &#124;
<a href="#pro-static-attribs">Protected Static Fields</a> &#124;
<a href="classaworx_1_1lib_1_1lang_1_1Singleton-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Singleton&lt; TDerivedClass &gt; Class Template Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="singleton_8hpp_source.html">singleton.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for Singleton&lt; TDerivedClass &gt;:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="classaworx_1_1lib_1_1lang_1_1Singleton__inherit__graph.svg" width="699" height="747"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for Singleton&lt; TDerivedClass &gt;:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="classaworx_1_1lib_1_1lang_1_1Singleton__coll__graph.svg" width="188" height="127"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<a name="details" id="details"></a><h2 class="groupheader">Class Description</h2>
<div class="textblock"><h3>template&lt;typename TDerivedClass&gt;<br />
class aworx::lib::lang::Singleton&lt; TDerivedClass &gt;</h3>

<hr/>
 <dl class="section note"><dt>Note</dt><dd>This class is extracted and exposed as an own <b>ALib Module</b>, found here: <a href="https://github.com/AlexWorx/ALib-Singleton">ALib Singleton</a>.</dd></dl>
<p><b>Background Information on Template Singletons and Windows OS DLLs:</b><br />
 This template class implements the singleton design pattern using templates. In principle, this is a very easy and straightforward thing and extensively discussed in the internet and programming literature. However, in combination with using DLLs on Windows OS, things get a little more complicated. A Windows OS DLL provides its own data segment and static function variables defined in template classes (in header files!) are duplicated within DLLs and the main executable. Now, if a standard implementation of the singleton pattern with templates is used, the singletons received are "DLL-wide singletons" but not "process-wide singletons".</p>
<p>Therefore, this implementation uses one static hash map to store each singleton instance of any type. Then, if a singleton is requested for the first time, this hash map is consulted for an already existing instance. Only if this fails, the singleton instance is created and stored in the hash map to be found by other DLLs or the main executable.<br />
 The pointer to the singleton created or found is then stored in static field <a class="el" href="classaworx_1_1lib_1_1lang_1_1Singleton.html#ac37af4d0d385966198f222080ae55271">singleton</a> of this class. This way, a second request for the singleton (from within the same software entity), will not have the need to search the map again. In other words, the data model is as follows: each derived template type will have exactly one singleton instance, stored in the static hash map which is defined only once (in the <b>ALib</b> DLL or library). Software entities that have their own data segment (e.g. Windows DLLs) each have one dedicated pointer to the singleton created by the entity itself or by one of the other entities.</p>
<p><b>Switching Compilation Mode:</b><br />
 As said above, the effort done with this implementations is needed only if a software process uses different data segments for different portions of the code, for example processes which open DLLs on Windows OS. As this effort imposes a (small) overhead, the implementation of this class can be switched to a simple implementation version, which just stores the singletons in a static field of the class. The implementation is controlled by code selection symbol <a class="el" href="group__GrpALibCodeSelectorSymbols.html#ga52f1ecb3310c948fcca7e0f9b706a495">ALIB_FEAT_SINGLETON_MAPPED</a>. On Windows OS the symbol defaults to <code>true</code>, otherwise to false.<br />
 Now, Compiler symbols <a class="el" href="group__GrpALibCompilerSymbols.html#ga854258c7143e2ab67fbd0e5abb7850dc">ALIB_FEAT_SINGLETON_MAPPED_ON</a> and <a class="el" href="group__GrpALibCompilerSymbols.html#gadd3d837a0c45194bd9d43af25c348e46">ALIB_FEAT_SINGLETON_MAPPED_OFF</a> can be used to overwrite this default settings. This could be done for the following reasons:</p><ul>
<li><b>ALib</b> is used on Windows OS, but not compiled as a DLL and the code that is using <b>ALib</b> is restricted to one DLL or the main application exclusively. In this case, symbol <a class="el" href="group__GrpALibCompilerSymbols.html#gadd3d837a0c45194bd9d43af25c348e46">ALIB_FEAT_SINGLETON_MAPPED_OFF</a> may be passed to the compiler to switch compilation to the simple mode.</li>
<li><b>ALib</b> is used on GNU/Linux, but the debug features for listing all singletons created (described below) should be used. In this case, for the purpose of debugging, symbol <a class="el" href="group__GrpALibCompilerSymbols.html#ga854258c7143e2ab67fbd0e5abb7850dc">ALIB_FEAT_SINGLETON_MAPPED_ON</a> may be passed to the compiler to switch compilation to use the hash map, even though this is not needed for that platform.</li>
</ul>
<p><b>Usage:</b><br />
 The implementation details described above are transparent in respect to using the class.</p>
<p>A user type may inherit the singleton feature from this class by being derived from it, with the template parameter <code>TDerivedClass</code> set to name just of the derived class type itself. Then, static method <a class="el" href="classaworx_1_1lib_1_1lang_1_1Singleton.html#aacc819bf0193ea5e1185fc98291b03aa">GetSingleton</a> will return a singleton of the derived type.</p>
<p>Here is a sample code deriving from this class:</p>
<div class="fragment"><div class="line"><span class="comment">// Derive a class from singleton, providing its name as template parameter:</span></div><div class="line"><span class="keyword">class </span>MyClass : <span class="keyword">public</span> <a class="code" href="classaworx_1_1lib_1_1lang_1_1Singleton.html">aworx::Singleton</a>&lt;MyClass&gt;</div><div class="line">{</div><div class="line">    <span class="comment">//... MyClass implementation</span></div><div class="line">};</div></div><!-- fragment --><p> Now, the singleton can be requested as follows:</p>
<div class="fragment"><div class="line"><span class="comment">// Then, the singleton can be received as:</span></div><div class="line">MyClass* myClassSingleton= MyClass::GetSingleton();</div><div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;The singleton of MyClass is: &quot;</span> &lt;&lt; std::hex  &lt;&lt; myClassSingleton &lt;&lt; std::endl;</div></div><!-- fragment --><p> Note that the singleton is <b>not</b> automatically the only instance of the custom class. In this respected, class <b>Singleton</b> is not <em>'strict'</em>:</p>
<div class="fragment"><div class="line">MyClass instance2;</div><div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Another instance of MyClass is: &quot;</span> &lt;&lt; std::hex  &lt;&lt; &amp;instance2     &lt;&lt; std::endl;</div></div><!-- fragment --><p> To create classes that implement strict singletons, two things have to be done:</p><ol type="1">
<li>Provide a private constructor to the derived class and</li>
<li>make parent class <b>Singleton</b> be a friend of it.</li>
</ol>
<p>This is shown in the following sample: </p><div class="fragment"><div class="line"><span class="comment">// Derive a class from singleton, providing its name as template parameter:</span></div><div class="line"><span class="keyword">class </span>JustOne : <span class="keyword">public</span> <a class="code" href="classaworx_1_1lib_1_1lang_1_1Singleton.html">aworx::Singleton</a>&lt;JustOne&gt;</div><div class="line">{</div><div class="line">    <span class="keyword">friend</span> <a class="code" href="classaworx_1_1lib_1_1lang_1_1Singleton.html">aworx::Singleton&lt;JustOne&gt;</a>;</div><div class="line">    <span class="keyword">private</span>: JustOne() {}</div><div class="line"></div><div class="line">    <span class="comment">//... class JustOne implementation</span></div><div class="line">};</div></div><!-- fragment --> <div class="fragment"><div class="line">JustOne *theOne= JustOne::GetSingleton();</div><div class="line">JustOne theSecond; <span class="comment">// Compiler error, not allowed!</span></div></div><!-- fragment --><p> Prior to terminating the process, the singletons can be destructed and deleted using namespace function <a class="el" href="namespaceaworx_1_1lib_1_1lang.html#a20cbd716cfc046a49f72978689279f29">aworx::lib::lang::DeleteSingletons</a>. See this method's description for more information. Especially Note that method <a class="el" href="classaworx_1_1lib_1_1ALIB.html#a2a0bcae1f7341255492ebc90deab5f01">ALIB::TerminationCleanUp</a> invokes this method already.</p>
<p><b>Restrictions / Penalties:</b><br />
</p>
<ul>
<li>The singleton class needs to have a default (parameterless) constructor. (This might be overcome with a templated get-method that forwards variadic arguments, but is not implemented here.)</li>
<li>The singleton class is virtual and hence all derived classes become virtual. This is needed to be able to have a virtual destructor.</li>
<li>There is a minimal performance penalty in comparison to more simple implementations of the singleton design pattern: Each <em>'code entity'</em> (DLL or main executable) needs to retrieve a singleton which was potentially already created by another code entity, <b>once</b>. In other words, only the first request for the singleton incorporates two small performance penalties for<ol type="1">
<li>setting and releasing a thread lock (mutex)</li>
<li>retrieving the singleton or inserting the singleton if not retrieved.</li>
</ol>
</li>
<li>The memory penalty is also quite minimal and imposed by the creation of a static hash table, which holds a pointer to each <a class="el" href="classaworx_1_1lib_1_1lang_1_1Singleton.html">Singleton</a>.</li>
<li>Upon exit of the process, programmers might want to explicitly free the hash table to avoid the detection of memory leaks by metrics tools like <a href="http://valgrind.org/">Valgrind</a>. (Otherwise this can be omitted, as the memory is cleaned by the OS probably much faster when a process exits).</li>
<li>In general, it is advised to think twice before implementing the singleton design pattern. Often, this is considered bad code design. However, there can be very good reasons for having singletons in software. And do not be frustrated if "very wise people" tell you that you must never use a singleton. Your answer to them is: Each and every created instance of a virtual C++ class contains a pointer to a singleton, namely the <a href="https://en.wikipedia.org/wiki/Virtual_method_table">vtable</a>!</li>
</ul>
<p><b>Listing Types in Debug Compilations:</b><br />
 As described above, to extend the singleton concept across DLL bounds, a static hash map is needed. Now, in debug compilations (see compilation symbol <a class="el" href="group__GrpALibCodeSelectorSymbols.html#gac56d0d10d022f28ce6bacdc612b4a743">ALIB_DEBUG</a>), this map can be dumped any time and this way all singletons created at a certain point at runtime can be listed. For this, <b>ALib</b> provides namespace function <a class="el" href="namespaceaworx_1_1lib_1_1debug.html#afb66ffb4ac637d163d0d829db7a408e9">GetSingletons</a>. This function is using class AString, and hence it is available only with <b>ALib</b> distributions that includes module <b>ALib String</b>. Fore example modules <a href="https://github.com/AlexWorx/ALib-Singleton">ALib Singleton</a> or <a href="https://github.com/AlexWorx/ALib-Boxing">ALib Boxing</a> are missing this method. The good news is, that it is quite easy to create an own debug method, just as the following sample shows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#if ALIB_DEBUG &amp;&amp; ALIB_FEAT_SINGLETON_MAPPED</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// import the map of singletons. This is not done in the header files!</span></div><div class="line">    <span class="keyword">namespace </span><a class="code" href="namespaceaworx.html">aworx</a> { <span class="keyword">namespace </span>lib { <span class="keyword">namespace </span>lang {</div><div class="line">        <span class="keyword">extern</span> <a class="code" href="group__GrpALibMacros.html#ga74fe706f3101d8e1e21555f772da2849">ALIB_API</a> TypeinfoMap&lt;void*&gt;  singletonMap;</div><div class="line">    }}}</div></div><!-- fragment --> <div class="fragment"><div class="line">    <span class="keywordtype">void</span>  DumpSingletons()</div><div class="line">    {</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Debug-Mode: Dumping Singletons: &quot;</span> &lt;&lt; std::endl;</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span>( <span class="keyword">auto</span> it : aworx::lib::lang::singletonMap )</div><div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;  &quot;</span></div><div class="line">                 &lt;&lt; <a class="code" href="classaworx_1_1lib_1_1debug_1_1TypeDemangler.html">aworx::lib::debug::TypeDemangler</a>(it.first.get()).<a class="code" href="namespaceaworx_1_1lib_1_1lang.html#af6d9cc1e6686eca6e60d57d959cf57fbac55582518cba2c464f29f5bae1c68def">Get</a>()</div><div class="line">                 &lt;&lt; <span class="stringliteral">&quot; = 0x&quot;</span> &lt;&lt; std::hex</div><div class="line">                 &lt;&lt; <span class="keyword">reinterpret_cast&lt;</span>uint64_t<span class="keyword">&gt;</span>(it.second)</div><div class="line">                 &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --> <dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">TDerivedClass</td><td>Template parameter that denotes the name of the class that implements the singleton. </td></tr>
  </table>
  </dd>
</dl>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Public Static Methods</h2></td></tr>
<tr class="memitem:aacc819bf0193ea5e1185fc98291b03aa"><td class="memItemLeft" align="right" valign="top">static TDerivedClass *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classaworx_1_1lib_1_1lang_1_1Singleton.html#aacc819bf0193ea5e1185fc98291b03aa">GetSingleton</a> ()</td></tr>
<tr class="separator:aacc819bf0193ea5e1185fc98291b03aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Methods</h2></td></tr>
<tr class="memitem:a7d833a82cba7b9c4083d4c071a771cfc"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classaworx_1_1lib_1_1lang_1_1Singleton.html#a7d833a82cba7b9c4083d4c071a771cfc">~Singleton</a> ()</td></tr>
<tr class="separator:a7d833a82cba7b9c4083d4c071a771cfc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-static-attribs"></a>
Protected Static Fields</h2></td></tr>
<tr class="memitem:ac37af4d0d385966198f222080ae55271"><td class="memItemLeft" align="right" valign="top">static TDerivedClass *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classaworx_1_1lib_1_1lang_1_1Singleton.html#ac37af4d0d385966198f222080ae55271">singleton</a> = nullptr</td></tr>
<tr class="separator:ac37af4d0d385966198f222080ae55271"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a7d833a82cba7b9c4083d4c071a771cfc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d833a82cba7b9c4083d4c071a771cfc">&#9670;&nbsp;</a></span>~Singleton()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual ~<a class="el" href="classaworx_1_1lib_1_1lang_1_1Singleton.html">Singleton</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Virtual destructor. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aacc819bf0193ea5e1185fc98291b03aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aacc819bf0193ea5e1185fc98291b03aa">&#9670;&nbsp;</a></span>GetSingleton()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static TDerivedClass* GetSingleton </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Creates (if not done, yet) and returns the singleton of type <code>TDerivedClass</code>. </p><dl class="section return"><dt>Returns</dt><dd>The singleton instance. </dd></dl>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="ac37af4d0d385966198f222080ae55271"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac37af4d0d385966198f222080ae55271">&#9670;&nbsp;</a></span>singleton</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">TDerivedClass * singleton = nullptr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>A pointer to the one and only singleton. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="singleton_8hpp_source.html">singleton.hpp</a></li>
</ul>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.12-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Sep 13 2017 18:47:58 for ALox by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
<!-- Start of StatCounter Code e -->
<script type="text/javascript">
var sc_project=11242602;
var sc_invisible=1;
var sc_security="5ac13373";
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="web statistics"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="//c.statcounter.com/11242602/0/5ac13373/1/" alt="web
statistics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</body>
</html>
